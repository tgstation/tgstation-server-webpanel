"use strict";(self.webpackChunktgstation_server_control_panel=self.webpackChunktgstation_server_control_panel||[]).push([[6867],{2153:function(e,t,a){a.r(t);var n=a(6540),i=a(8065),s=a(4180),r=a(2576),o=a(1824),l=a(5301),c=a(379),d=a(7621),m=a(4118),u=a(7567),p=a(1723),f=a(6113),h=a(6795),S=a(7255);class v extends n.Component{constructor(e){super(e),this.editInstance=this.editInstance.bind(this),this.state={errors:[],moving:!1}}addError(e){this.setState((t=>{const a=Array.from(t.errors);return a.push(e),{errors:a}}))}async editInstance(e){if(e.autoUpdateCron&&e.autoUpdateInterval)return void alert("Cannot set both auto update interval and cron!");const t=this.context.instance.id;let a;e.path&&e.path!=this.context.instance.path&&(a=e.path,e.path=null,e.online=!1,this.setState({moving:!0}));const n=await o.A.editInstance({...e,id:t});if(n.code!==l.s.OK)return this.addError(n.error),void this.setState({moving:!1});if(a){const e=await o.A.editInstance({id:this.context.instance.id,path:a});if(e.code!==l.s.OK)return this.addError(e.error),this.setState({moving:!1}),void await this.context.reloadInstance();let n;do{if(await new Promise((e=>setTimeout(e,1e3))),n=await o.A.getInstance(t),n.code!==l.s.OK)return this.addError(n.error),this.setState({moving:!1}),void await this.context.reloadInstance()}while(n.payload.moveJob);const i=await o.A.editInstance({online:!0,id:t});i.code!==l.s.OK?(this.addError(i.error),this.setState({moving:!1})):c.default.registerJob(e.payload.moveJob,t)}await this.context.reloadInstance()}render(){const e=e=>(0,m.tL)((0,m.u)(this.context.user),e),t={name:{name:"fields.instance.name",type:p.PU.String,defaultValue:this.context.instance.name,disabled:!e(r.cq.Rename)},path:{name:"fields.instance.path",type:p.PU.String,defaultValue:this.context.instance.path,disabled:!e(r.cq.Relocate)},chatBotLimit:{name:"fields.instance.chatbotlimit",type:p.PU.Number,min:0,defaultValue:this.context.instance.chatBotLimit,disabled:!e(r.cq.SetChatBotLimit)},autoUpdateCron:{name:"fields.instance.cron",type:p.PU.String,defaultValue:this.context.instance.autoUpdateCron,disabled:!e(r.cq.SetAutoUpdate)},autoUpdateInterval:{name:"fields.instance.autoupdate",type:p.PU.Number,min:0,defaultValue:this.context.instance.autoUpdateInterval,disabled:!e(r.cq.SetAutoUpdate)},configurationType:{name:"fields.instance.filemode",type:p.PU.Enum,enum:r.HB,defaultValue:this.context.instance.configurationType,disabled:!e(r.cq.SetConfiguration)}};return n.createElement("div",{className:"text-center"},n.createElement("h1",null,n.createElement(i.A,{id:"view.instance.info"})),n.createElement(h.Q,{obj:this.context}),this.state.errors.map(((e,t)=>{if(e)return n.createElement(u.Ay,{key:t,error:e,onClose:()=>this.setState((e=>{const a=Array.from(e.errors);return a[t]=void 0,{errors:a}}))})})),this.state.moving?n.createElement(S.default,{text:"loading.instance.move"}):n.createElement(f.A,{fields:t,onSave:this.editInstance}))}}v.contextType=d.z,t.default=(0,s.y)(v)},5998:function(e,t,a){a.r(t),a.d(t,{Deployment:function(){return b}});var n=a(6540),i=a(5615),s=a(8065),r=a(1930),o=a(2576),l=a(5301),c=a(379),d=a(7621),m=a(4118),u=a(9956),p=a(7567),f=a(5659),h=a(1723),S=a(6113),v=a(6795),g=a(7255),y=a(1512);function b(){const e=(0,n.useContext)(d.z),t=(0,n.useState)([]),[a,b]=(0,n.useState)(!0),[E,w]=(0,n.useState)(null),[A,P]=(0,n.useState)(null),[N,C]=(0,n.useState)(1),[R,x]=(0,n.useState)(0),[B,V]=(0,n.useState)(5),O=(0,m.eG)(e.instancePermissionSet,o.rY.Read),I=(0,m.eG)(e.instancePermissionSet,o.rY.Compile),U=(0,m.eG)(e.instancePermissionSet,o.rY.CompileJobs);async function Y(){if(!O)return b(!1);b(!0);const a=await r.A.getDeployInfo(e.instance.id);b(!1),a.code===l.s.OK?w(a.payload):(0,p.CN)(t,a.error)}async function G(a){if(!U)return;P(null);const n=await r.A.listCompileJobs(e.instance.id,{page:a,pageSize:B});n.code===l.s.OK?(B||V(n.payload.pageSize),x(n.payload.totalPages),C(a),P(n.payload.content)):(0,p.CN)(t,n.error)}let _;(0,n.useEffect)((()=>{Y(),G(1)}),[e.instance.id]);const k=/(?:(?<days>\d+)\.)?(?<hours>\d+):(?<minutes>\d+):(?<seconds>\d+)/.exec(E?.timeout??"");if(k){const e=k.groups;_=60*(24*parseInt(e.days??0)+parseInt(e.hours))+parseInt(e.minutes)+parseInt(e.seconds)/60}const W={projectName:{type:h.PU.String,name:"fields.instance.deploy.projectname",tooltip:"fields.instance.deploy.projectname.desc",defaultValue:E?.projectName,disabled:!(0,m.eG)(e.instancePermissionSet,o.rY.SetDme)},compilerAdditionalArguments:{type:h.PU.String,name:"fields.instance.deploy.compilerargs",tooltip:"fields.instance.deploy.compilerargs.desc",defaultValue:E?.compilerAdditionalArguments,disabled:!(0,m.eG)(e.instancePermissionSet,o.rY.SetCompilerArguments)},timeout:{type:h.PU.Number,name:"fields.instance.deploy.timeout",tooltip:"fields.instance.deploy.timeout.desc",defaultValue:_,disabled:!(0,m.eG)(e.instancePermissionSet,o.rY.SetTimeout)},apiValidationPort:{type:h.PU.Number,min:0,max:65535,name:"fields.instance.deploy.apiport",tooltip:"fields.instance.deploy.apiport.desc",defaultValue:E?.apiValidationPort,disabled:!(0,m.eG)(e.instancePermissionSet,o.rY.SetApiValidationPort)},apiValidationSecurityLevel:{type:h.PU.Enum,enum:o.GZ,name:"fields.instance.deploy.seclevel",tooltip:"fields.instance.deploy.seclevel.desc",defaultValue:E?.apiValidationSecurityLevel,disabled:!(0,m.eG)(e.instancePermissionSet,o.rY.SetSecurityLevel)},requireDMApiValidation:{type:h.PU.Boolean,name:"fields.instance.deploy.validateapi",tooltip:"fields.instance.deploy.validateapi.desc",defaultValue:E?.requireDMApiValidation,disabled:!(0,m.eG)(e.instancePermissionSet,o.rY.SetApiValidationRequirement)}};let D=null;const M={currentPage:N,totalPages:R,loadPage:G,pageSize:B??0};return U?A&&(D={viewDataType:u.G.CompileJobs,compileJobs:A,paging:M}):D={viewDataType:u.G.CompileJobs,paging:M},n.createElement("div",{className:"text-center"},n.createElement(v.Q,{obj:{deployInfo:E}}),(0,p.u9)(t),U?n.createElement(u.A,{viewData:D}):n.createElement(f.A,{title:"view.instance.no_compile_jobs"}),n.createElement("hr",null),n.createElement("h3",null,n.createElement(s.A,{id:"view.instance.deploy.title"})),O?null:n.createElement(f.A,{title:"view.instance.no_metadata"}),a?n.createElement(g.default,{text:"loading.deployments"}):n.createElement(n.Fragment,null,n.createElement(S.A,{hideDisabled:!O,fields:W,onSave:async a=>{let n;if(a.timeout){const e=Math.floor(a.timeout/1440);a.timeout-=1440*e;const t=Math.floor(a.timeout/60);a.timeout-=60*t;const i=Math.floor(a.timeout);a.timeout-=i;const s=Math.floor(60*a.timeout);n=e?`${e}.${t}:${i}:${s}`:`${t}:${i}:${s}`}const i={...a,timeout:n};b(!0);const s=await r.A.updateDeployInfo(e.instance.id,i);s.code===l.s.ERROR?(0,p.CN)(t,s.error):await Y(),b(!1)}}),n.createElement("hr",null),n.createElement(y.A,{tooltipid:"generic.no_perm",show:!I&&void 0},n.createElement(i.A,{disabled:!I,onClick:()=>{(async()=>{const a=await r.A.startCompile(e.instance.id);a.code===l.s.ERROR?(0,p.CN)(t,a.error):(c.default.registerJob(a.payload,e.instance.id),c.default.fastmode=5)})()}},n.createElement(s.A,{id:"view.instance.deploy.deploy"})))))}},9272:function(e,t,a){a.r(t),a.d(t,{default:function(){return f}});var n=a(6540),i=a(4295),s=a(5301),r=a(379),o=a(7621),l=a(664),c=a(7567),d=a(2306),m=a(6795),u=a(7255),p=a(5282);function f(){const e=n.useContext(o.z),[t,a]=(0,n.useState)([]),[f,h]=(0,n.useState)([]),[S,v]=(0,n.useState)(!0),[g,y]=(0,n.useState)(l.M2.jobhistorypage.get(e.instance.id)??1),[b,E]=(0,n.useState)(void 0);function w(e){h((t=>{const a=Array.from(t);return a.push(e),a}))}return(0,n.useEffect)((()=>{l.M2.jobhistorypage.set(e.instance.id,g),v(!0),async function(){const t=await i.A.listJobs(e.instance.id,{page:g});t.code===s.s.OK?(g>t.payload.totalPages&&0!==t.payload.totalPages&&y(1),a(t.payload.content),E(t.payload.totalPages)):w(t.error),v(!1)}()}),[g,e.instance.id]),(0,n.useEffect)((()=>{}),[f]),S?n.createElement(u.default,{text:"loading.instance.jobs.list"}):n.createElement("div",null,n.createElement(m.Q,{obj:t}),f.map(((e,t)=>{if(e)return n.createElement(c.Ay,{key:t,error:e,onClose:()=>h((e=>{const a=Array.from(e);return a[t]=void 0,a}))})})),t.sort(((e,t)=>t.id-e.id)).filter((e=>!!e.stoppedAt)).map((e=>n.createElement(d.A,{job:e,key:e.id,onCancel:e=>{!async function(e){const t=await i.A.deleteJob(e.instanceId,e.id);t.code===s.s.OK?r.default.fastmode=5:w(t.error)}(e)}}))),n.createElement(p.A,{selectPage:e=>y(e),totalPages:b??1,currentPage:g}))}},8018:function(e,t,a){a.r(t);var n=a(6540),i=a(6052),s=a(5615),r=a(5038),o=a(3524),l=a(8065),c=a(8798),d=a(9589),m=a(4366),u=a(2576),p=a(5301),f=a(379),h=a(7621),S=a(4118),v=a(9956),g=a(7567),y=a(5659),b=a(1723),E=a(6113),w=a(6795),A=a(7255),P=function(e){return e[e.None=0]="None",e[e.Stop=1]="Stop",e[e.Restart=2]="Restart",e}(P||{});t.default=(0,c.Ay)((function(e){const t=(0,n.useContext)(h.z),[a,c]=(0,n.useState)(),[N,C]=(0,n.useState)(!1),R=(0,n.useState)([]);async function x(){if(!(0,S.GY)(t.instancePermissionSet,u.NB.ReadMetadata))return c({});const e=await m.A.getWatchdogStatus(t.instance.id);e.code===p.s.ERROR?(0,g.CN)(R,e.error):c(e.payload)}async function B(e){C(!0);const a=await m.A.updateWatchdogStatus(t.instance.id,e);a.code===p.s.ERROR&&(0,g.CN)(R,a.error),await x(),C(!1)}if((0,n.useEffect)((()=>{x()}),[t.instance.id]),!a)return n.createElement(n.Fragment,null,(0,g.u9)(R));if(N)return n.createElement(A.default,null);const V={autoStart:{type:b.PU.Boolean,name:"fields.instance.watchdog.autostart",defaultValue:a.autoStart,disabled:!(0,S.GY)(t.instancePermissionSet,u.NB.SetAutoStart)},startProfiler:{type:b.PU.Boolean,name:"fields.instance.watchdog.autostartprofiler",defaultValue:a.startProfiler,disabled:!(0,S.GY)(t.instancePermissionSet,u.NB.SetProfiler)},logOutput:{type:b.PU.Boolean,name:"fields.instance.watchdog.logoutput",defaultValue:a.logOutput,disabled:!(0,S.GY)(t.instancePermissionSet,u.NB.SetLogOutput)},port:{type:b.PU.Number,name:"fields.instance.watchdog.port",defaultValue:a.port,min:0,max:65535,disabled:!(0,S.GY)(t.instancePermissionSet,u.NB.SetPort)},visibility:{type:b.PU.Enum,name:"fields.instance.watchdog.visibility",defaultValue:a.visibility,enum:u.mS,disabled:!(0,S.GY)(t.instancePermissionSet,u.NB.SetVisibility)},securityLevel:{type:b.PU.Enum,name:"fields.instance.watchdog.securitylevel",defaultValue:a.securityLevel,enum:u.GZ,disabled:!(0,S.GY)(t.instancePermissionSet,u.NB.SetSecurity)},startupTimeout:{type:b.PU.Number,name:"fields.instance.watchdog.timeout.startup",defaultValue:a.startupTimeout,min:0,disabled:!(0,S.GY)(t.instancePermissionSet,u.NB.SetStartupTimeout)},topicRequestTimeout:{type:b.PU.Number,name:"fields.instance.watchdog.timeout.topic",defaultValue:a.topicRequestTimeout,min:0,disabled:!(0,S.GY)(t.instancePermissionSet,u.NB.SetTopicTimeout)},healthCheckSeconds:{type:b.PU.Number,name:"fields.instance.watchdog.healthcheck",defaultValue:a.healthCheckSeconds,min:0,disabled:!(0,S.GY)(t.instancePermissionSet,u.NB.SetHealthCheckInterval)},dumpOnHealthCheckRestart:{type:b.PU.Boolean,name:"fields.instance.watchdog.dumpOnHealthCheckRestart",defaultValue:a.dumpOnHealthCheckRestart,disabled:!(0,S.GY)(t.instancePermissionSet,u.NB.CreateDump)},minidumps:{type:b.PU.Boolean,name:"fields.instance.watchdog.minidumps",defaultValue:a.minidumps,disabled:!(0,S.GY)(t.instancePermissionSet,u.NB.SetMinidumps)},allowWebClient:{type:b.PU.Boolean,name:"fields.instance.watchdog.allowwebclient",defaultValue:a.allowWebClient,disabled:!(0,S.GY)(t.instancePermissionSet,u.NB.SetWebClient)},additionalParameters:{type:b.PU.String,name:"fields.instance.watchdog.additionalparams",defaultValue:a.additionalParameters,disabled:!(0,S.GY)(t.instancePermissionSet,u.NB.SetAdditionalParameters)},mapThreads:{type:b.PU.Number,name:"fields.instance.watchdog.mapthreads",defaultValue:a.mapThreads,disabled:!(0,S.GY)(t.instancePermissionSet,u.NB.SetMapThreads)},openDreamTopicPort:{type:b.PU.Number,name:"fields.instance.watchdog.od_topic_port",tooltip:"fields.instance.watchdog.od_topic_port.desc",defaultValue:a.openDreamTopicPort,min:0,max:65535,disabled:!(0,S.GY)(t.instancePermissionSet,u.NB.SetPort)}},O=Object.values(V).some((e=>!e.disabled)),I=n.createElement(o.A,{id:"generic.no_perm"},n.createElement(l.A,{id:"generic.no_perm"})),U=(0,S.GY)(t.instancePermissionSet,u.NB.Start),Y=(0,S.GY)(t.instancePermissionSet,u.NB.Shutdown),G=(0,S.GY)(t.instancePermissionSet,u.NB.Restart),_=(0,S.GY)(t.instancePermissionSet,u.NB.CreateDump),k=(0,S.GY)(t.instancePermissionSet,u.NB.ReadMetadata),W=(0,S.GY)(t.instancePermissionSet,u.NB.SoftShutdown)||(0,S.GY)(t.instancePermissionSet,u.NB.SoftRestart),D=U||Y||G||_,M=!(0,S.GY)(t.instancePermissionSet,u.NB.BroadcastMessage)||k&&(a.status!==u._W.Online||null!=a.activeCompileJob?.dmApiVersion&&!(0,d.gte)(a.activeCompileJob?.dmApiVersion,"5.7.0")),T={message:{type:b.PU.String,name:"fields.instance.watchdog.broadcast",defaultValue:"",disabled:M,tooltip:"fields.instance.watchdog.broadcast.desc"}},J=(0,S.GY)(t.instancePermissionSet,u.NB.ReadRevision);let j=null;a&&(j={viewDataType:v.G.Watchdog,activeCompileJob:a.activeCompileJob,stagedCompileJob:a.stagedCompileJob});const q=1073741824,L=a?.immediateMemoryUsage;return n.createElement("div",{className:"text-center"},n.createElement(w.Q,{obj:a}),(0,g.u9)(R),n.createElement("h2",{className:"text-center"},n.createElement(l.A,{id:"view.instance.server.status"}),n.createElement(i.A,{pill:!0,variant:a.status===u._W.Online?"success":a.status===u._W.Offline?"danger":"warning"},n.createElement(l.A,{id:`view.instance.server.status.${u._W[a.status]}`}))),L?n.createElement("h4",null,n.createElement(i.A,{pill:!0,variant:j?.activeCompileJob?.engineVersion.engine==u.p3.OpenDream?"success":L>3221225472?"danger":L>2147483648?"warning":"success"},n.createElement("div",null,n.createElement(l.A,{id:"view.instance.server.status.ram"}),":\xa0",Math.round(L/q*100)/100,"GB"))):null,n.createElement("hr",null),J?n.createElement(v.A,{viewData:j}):n.createElement(y.A,{title:"view.instance.no_compile_jobs"}),n.createElement("hr",null),n.createElement("h3",{className:"text-center"},n.createElement(l.A,{id:"view.instance.server.settings"})),k?null:O?n.createElement(y.A,{title:"view.instance.no_metadata"}):n.createElement(y.A,{title:"view.instance.server.no_metadata_and_no_settings"}),n.createElement(E.A,{fields:V,onSave:B,hideDisabled:!k}),n.createElement("hr",null),n.createElement("h3",{className:"text-center"},n.createElement(l.A,{id:"view.instance.server.actions"})),D?n.createElement(n.Fragment,null,k?null:n.createElement(y.A,{title:"view.instance.server.no_metadata_actions"}),n.createElement("div",{className:"text-center mb-3"},n.createElement(r.A,{overlay:I,show:!U&&void 0},n.createElement(s.A,{variant:"success",className:"mx-2",onClick:()=>{!async function(){C(!0);const e=await m.A.startWatchdog(t.instance.id);e.code===p.s.ERROR?(0,g.CN)(R,e.error):(f.default.registerCallback(e.payload.id,(()=>{x()})),f.default.fastmode=5,await x()),C(!1)}()},disabled:k&&a.status!=u._W.Offline||!U},n.createElement(l.A,{id:"view.instance.server.start"}))),n.createElement(r.A,{overlay:I,show:!Y&&void 0},n.createElement(s.A,{variant:"danger",className:"mx-2",onClick:()=>{!async function(){if(!confirm(e.intl.formatMessage({id:"view.instance.server.prompt.stop"})))return;C(!0);const a=await m.A.stopWatchdog(t.instance.id);a.code===p.s.ERROR?(0,g.CN)(R,a.error):await x(),C(!1)}()},disabled:k&&a.status==u._W.Offline||!Y},n.createElement(l.A,{id:"view.instance.server.stop"}))),n.createElement(r.A,{overlay:I,show:!G&&void 0},n.createElement(s.A,{variant:"warning",className:"mx-2",onClick:()=>{!async function(){if(!confirm(e.intl.formatMessage({id:"view.instance.server.prompt.restart"})))return;C(!0);const a=await m.A.restartWatchdog(t.instance.id);a.code===p.s.ERROR?(0,g.CN)(R,a.error):(f.default.registerCallback(a.payload.id,(()=>{x()})),f.default.fastmode=5,await x()),C(!1)}()},disabled:k&&a.status==u._W.Offline||!G},n.createElement(l.A,{id:"view.instance.server.restart"}))),n.createElement(r.A,{overlay:I,show:!_&&void 0},n.createElement(s.A,{variant:"info",className:"mx-2",onClick:()=>{!async function(){C(!0);const e=await m.A.dumpWatchdog(t.instance.id);e.code===p.s.ERROR?(0,g.CN)(R,e.error):f.default.fastmode=5,C(!1)}()},disabled:k&&a.status!=u._W.Online||!_},n.createElement(l.A,{id:"view.instance.server.dump"}))))):n.createElement(y.A,{title:"view.instance.server.no_actions"}),!k&&W?n.createElement(y.A,{title:"view.instance.server.no_metadata_graceful"}):null,k||W?n.createElement("div",{className:"w-75 mx-auto"},n.createElement(b.Ay,{name:"view.instance.graceful",type:b.PU.Enum,enum:P,tooltip:"view.instance.graceful.desc",defaultValue:a.softRestart?P.Restart:a.softShutdown?P.Stop:P.None,disabled:!W,onChange:e=>{switch(e){case P.None:if(!a?.softRestart&&!a?.softShutdown)return;B({softShutdown:!a.softShutdown&&void 0,softRestart:!a.softRestart&&void 0});break;case P.Stop:if(a?.softShutdown)return;B({softShutdown:!0});break;case P.Restart:if(a?.softRestart)return;B({softRestart:!0})}}})):D?n.createElement(y.A,{title:"view.instance.server.no_graceful"}):null,n.createElement("div",{className:"w-75 mx-auto"},n.createElement("br",null),n.createElement(E.A,{fields:T,onSave:e=>{B({broadcastMessage:e.message})},saveMessageId:"view.instance.server.broadcast"})))}))},9248:function(e,t,a){a.r(t);var n=a(6188),i=a(6784),s=a(6540),r=a(472),o=a(6867),l=a(1008),c=a(8065),d=a(4180),m=a(2576),u=a(1824),p=a(2589),f=a(5301),h=a(8437),S=a(7864),v=a(7621),g=a(664),y=a(992),b=a(7255),E=a(5755),w=a(3763),A=a(2153),P=a(5998),N=a(4717),C=a(1606),R=a(9496),x=a(9272),B=a(3649),V=a(8018);const O=m.em.ReadActive|m.em.ListInstalled|m.em.InstallOfficialOrChangeActiveByondVersion|m.em.InstallCustomByondVersion|m.em.InstallOfficialOrChangeActiveOpenDreamVersion|m.em.InstallCustomOpenDreamVersion,I=m.NB.SetPort|m.NB.SetAutoStart|m.NB.SetSecurity|m.NB.ReadMetadata|m.NB.SetWebClient|m.NB.SoftRestart|m.NB.SoftShutdown|m.NB.Restart|m.NB.Shutdown|m.NB.Start|m.NB.SetStartupTimeout|m.NB.SetHealthCheckInterval|m.NB.CreateDump|m.NB.SetTopicTimeout|m.NB.SetAdditionalParameters|m.NB.SetVisibility,U=m.WX.SetOrigin|m.WX.SetSha|m.WX.MergePullRequest|m.WX.UpdateBranch|m.WX.ChangeCommitter|m.WX.ChangeTestMergeCommits|m.WX.ChangeCredentials|m.WX.SetReference|m.WX.Read|m.WX.ChangeAutoUpdateSettings|m.WX.Delete|m.WX.ChangeSubmoduleUpdate,Y=m.rY.Read|m.rY.Compile|m.rY.SetApiValidationPort|m.rY.SetDme|m.rY.SetApiValidationRequirement|m.rY.SetTimeout|m.rY.SetSecurityLevel,G=m.B5.Read|m.B5.Create,_=m.qd.Read|m.qd.List|m.qd.Write;class k extends s.Component{constructor(e){super(e),this.reloadInstance=this.reloadInstance.bind(this),this.deleteContextError=this.deleteContextError.bind(this),g.M2.selectedinstanceid=parseInt(this.props.match.params.id),this.state={tab:e.match.params.tab??k.tabs[0][0],errors:new Set,instance:null,instancePermissionSet:null,reloadInstance:this.reloadInstance,deleteError:this.deleteContextError,instanceid:parseInt(this.props.match.params.id)}}deleteContextError(e){this.setState((t=>{const a=new Set(t.errors);return a.delete(e),{errors:a}}))}async componentDidMount(){await this.reloadInstance()}componentDidUpdate(e){this.props.match.params.tab&&e.match.params.tab!=this.props.match.params.tab&&this.setState({tab:this.props.match.params.tab})}async reloadInstance(){this.setState({instance:null,instancePermissionSet:null});const e=await u.A.getInstance(this.state.instanceid);if(e.code===f.s.OK){this.setState({instance:e.payload});const t=await p.A.getCurrentInstancePermissionSet(this.state.instanceid,!0);t.code===f.s.OK?this.setState({instancePermissionSet:t.payload}):this.setState((e=>{const a=new Set(e.errors);return a.add(t.error),{instancePermissionSet:null,errors:a}}))}else this.setState((t=>{const a=new Set(t.errors);return a.add(e.error),{instance:null,errors:a}}))}render(){if(!this.state.instance||!this.state.instancePermissionSet)return s.createElement(b.default,{text:"loading.instance"});return s.createElement(v.z.Provider,{value:Object.assign({user:this.context.user,serverInfo:this.context.serverInfo},this.state)},s.createElement(r.A,{className:"behind-nav"},s.createElement(r.A.Header,{className:"text-center mb-2 sticky-top"},s.createElement("h3",null,s.createElement(c.A,{id:"view.instanceedit.title",values:{instanceid:this.props.match.params.id,instancename:this.state.instance.name}})),s.createElement("h5",{className:"text-white-50"},s.createElement(c.A,{id:`view.instanceedit.tabs.${this.state.tab}`}))),s.createElement(l.A.Container,{mountOnEnter:!0,unmountOnExit:!0,id:"instanceedit",activeKey:this.state.tab},s.createElement("div",{className:"d-flex flex-row z-front"},s.createElement(r.A.Body,{className:"flex-grow-0"},(()=>s.createElement(o.A,{defaultActiveKey:this.state.tab,onSelect:e=>{e=e??k.tabs[0][0],g.M2.selectedinstanceedittab=e,this.props.history.push(g.Sb.instanceedit.link??g.Sb.instanceedit.route),this.setState({tab:e??k.tabs[0][0]})},fill:!0,variant:"pills",activeKey:this.state.tab,className:"flex-nowrap text-nowrap flex-column hover-bar sticky-top "+(h.Ay.instanceeditsidebar.value===h.iD.COLLAPSE?"pin-close":h.Ay.instanceeditsidebar.value===h.iD.EXPAND?"pin-open":""),style:{top:"8em"}},k.tabs.map((([e,t,a,n])=>{if(!this.state.instancePermissionSet)throw Error("this.state.instancePermissionSet is null in instanceedit nav map");const r=!n,l=!a(this.state.instancePermissionSet,this.context);return s.createElement(o.A.Item,{key:e},s.createElement(o.A.Link,{eventKey:e,bsPrefix:"nav-link instanceedittab",className:(r?"no-access text-white":"")+(l?"no-access text-white font-italic":"")+" text-left"},s.createElement(s.Fragment,null,s.createElement(i.g,{icon:l?"lock":t,fixedWidth:!0}),s.createElement("div",{className:"tab-text d-inline-block "+(l?"font-weight-lighter":"")},s.createElement("span",{className:"pl-1"},s.createElement(c.A,{id:`view.instanceedit.tabs.${e}`}))))))}))))()),s.createElement(r.A.Body,{className:"bg-body"},s.createElement(l.A.Content,null,k.tabs.map((([e,,t,a])=>{if(!this.state.instancePermissionSet)throw Error("this.state.instancePermissionSet is null in render card map");return s.createElement(l.A.Pane,{eventKey:e,key:e},a?t(this.state.instancePermissionSet,this.context)?s.createElement(a,null):s.createElement(y.A,null):s.createElement(E.A,null))}))))))))}}k.tabs=[["info","info",()=>!0,A.default],["repository","code-branch",e=>!!(e.repositoryRights&U),B.default],["engine",n.Rbk,e=>!!(e.engineRights&O),N.default],["deployment","hammer",e=>!!(e.dreamMakerRights&Y),P.Deployment],["dreamdaemon","server",e=>!!(e.dreamDaemonRights&I),V.default],["chatbots","comments",e=>!!(e.chatBotRights&G),w.default],["files","folder-open",e=>!!(e.configurationRights&_),C.default],["users","users",()=>!0,R.default],["jobs","stream",()=>!0,x.default]],k.contextType=S.U,t.default=(0,d.y)(k)}}]);
//# sourceMappingURL=6867.39ade2f89b5a54c2c509.bundle.js.map
(self.webpackChunktgstation_server_control_panel=self.webpackChunktgstation_server_control_panel||[]).push([[9838,5855],{58187:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return S}});var r=n(67294),o=n(29558),a=n(96846),s=n(53803),i=n(75631),l=n(16942),u=n(50452),c=n(35855),d=n(44615),f=n(79274);class h{constructor(e,t){this.locale=e,this.messages=t}}class g{static getShortHandedLocale(e){return e.split("-")[0]}async loadTranslation(e){const t=await n(862)(`./${e}.json`);if(!t){let t=g.getShortHandedLocale(e);if(t===e){if(t===g.fallbackLocale)throw new Error("Invalid locale: "+e);t=g.fallbackLocale}return await this.loadTranslation(t)}let r=null;try{r=new h(e,t)}catch(t){throw Error(`Error loading localization for locale '${e}': ${JSON.stringify(t)}`)}return r}}g.fallbackLocale=f.Z.en;var p=g;const C=Promise.all([n.e(5322),n.e(6373)]).then(n.bind(n,86373)),m=Promise.all([n.e(3117),n.e(6834)]).then(n.bind(n,56834)),x=n.e(7806).then(n.bind(n,57806)),v=Promise.all([n.e(9521),n.e(422)]).then(n.bind(n,39521)),I=r.lazy((()=>Promise.all([n.e(9521),n.e(2480),n.e(3117),n.e(422),n.e(2856),n.e(5779),n.e(6364)]).then(n.bind(n,96845))));class E extends r.Component{constructor(e){super(e),this.translationFactory=void 0,this.finishLogin=this.finishLogin.bind(this),this.finishLogout=this.finishLogout.bind(this),this.updateContextUser=this.updateContextUser.bind(this),this.updateContextServer=this.updateContextServer.bind(this),this.deleteGeneralContextError=this.deleteGeneralContextError.bind(this),this.translationFactory=this.props.translationFactory??new p,this.state={loggedIn:!1,loggedOut:!1,loading:!0,polyfills:!1,GeneralContextInfo:{errors:new Set,user:null,serverInfo:null,deleteError:this.deleteGeneralContextError}}}async updateContextUser(){const e=await l.Z.getCurrentUser();e.code===s.G.OK?this.setState((t=>({GeneralContextInfo:{errors:t.GeneralContextInfo.errors,user:e.payload,serverInfo:t.GeneralContextInfo.serverInfo,deleteError:t.GeneralContextInfo.deleteError}}))):e.error.code===a.jK.HTTP_ACCESS_DENIED?this.setState((e=>({GeneralContextInfo:{user:null,serverInfo:e.GeneralContextInfo.serverInfo,deleteError:e.GeneralContextInfo.deleteError,errors:e.GeneralContextInfo.errors}}))):(setTimeout((()=>{this.updateContextUser()}),5e3),this.setState((t=>{const n=new Set(t.GeneralContextInfo.errors);return n.add(e.error),{GeneralContextInfo:{errors:n,deleteError:t.GeneralContextInfo.deleteError,user:null,serverInfo:t.GeneralContextInfo.serverInfo}}})))}async updateContextServer(e){const t=await i.Z.getServerInfo();t.code===s.G.OK?this.setState((n=>{const r=new Set(n.GeneralContextInfo.errors);return e&&r.delete(e),{GeneralContextInfo:{errors:r,user:n.GeneralContextInfo.user,serverInfo:t.payload,deleteError:n.GeneralContextInfo.deleteError}}})):(setTimeout((()=>{this.updateContextServer(t.error)}),5e3),this.setState((n=>{const r=new Set(n.GeneralContextInfo.errors);return r.add(t.error),e&&r.delete(e),{GeneralContextInfo:{errors:r,deleteError:n.GeneralContextInfo.deleteError,user:n.GeneralContextInfo.user,serverInfo:null}}})))}deleteGeneralContextError(e){this.setState((t=>{const n=new Set(t.GeneralContextInfo.errors);return n.delete(e),{GeneralContextInfo:{deleteError:t.GeneralContextInfo.deleteError,user:t.GeneralContextInfo.user,serverInfo:t.GeneralContextInfo.serverInfo,errors:n}}}))}finishLogin(){console.log("Logging in"),this.updateContextUser().then((()=>this.setState({loggedIn:!0,loading:!1})))}finishLogout(){this.setState({loggedIn:!1,loggedOut:!0}),this.updateContextUser()}async componentDidMount(){(await m).default(),(await x).default.loadconfig(),(await v).default.init(),u.Z.on("loginSuccess",this.finishLogin),i.Z.on("logout",this.finishLogout),i.Z.on("purgeCache",this.updateContextServer),i.Z.on("purgeCache",this.updateContextUser),await C,this.setState({polyfills:!0}),await this.loadTranslation();const e=await i.Z.initApi();await this.updateContextServer(),e&&await this.updateContextUser(),this.setState({loading:!1,loggedIn:e})}componentWillUnmount(){u.Z.removeListener("loginSuccess",this.finishLogin),i.Z.removeListener("logout",this.finishLogout),i.Z.removeListener("purgeCache",this.updateContextServer),i.Z.removeListener("purgeCache",this.updateContextUser)}render(){return this.state.polyfills?this.state.translationError?r.createElement("p",{className:"App-error"},this.state.translationError):this.state.translation?r.createElement(o.Z,{locale:this.state.translation.locale,messages:this.state.translation.messages,defaultLocale:"en"},r.createElement(r.Suspense,{fallback:r.createElement(c.default,{text:"loading.app"})},r.createElement(d.f.Provider,{value:this.state.GeneralContextInfo},r.createElement(I,{loading:this.state.loading,loggedIn:this.state.loggedIn,loggedOut:this.state.loggedOut})))):r.createElement(c.default,null,"Loading translations..."):r.createElement(c.default,null,"Loading polyfills...")}async loadTranslation(){console.time("LoadTranslations");try{const e=await this.translationFactory.loadTranslation(this.props.locale);this.setState({translation:e})}catch(e){return void this.setState({translationError:JSON.stringify(e)??"An unknown error occurred"})}console.timeEnd("LoadTranslations")}}var S=E},35855:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return l}});var r=n(67294),o=n(36968),a=n(44012);function s(){return s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},s.apply(this,arguments)}const i=r.lazy((()=>Promise.all([n.e(2856),n.e(6775)]).then(n.bind(n,16775))));class l extends r.Component{render(){return r.createElement(r.Suspense,{fallback:this.renderSpinner()},r.createElement(i,null,this.renderSpinner()))}renderSpinner(){const{variant:e,animation:t,center:n,className:i,width:l,widthUnit:u,text:c,children:d,...f}=this.props,h={width:`${l}${u}`,height:`${l}${u}`};return r.createElement("div",{className:n?"text-center":""},r.createElement(o.Z,s({variant:e||"secondary",className:n?`d-block mx-auto ${i??""}`:i,style:h,animation:t||"border"},f)),c?this.props.noIntl?c:r.createElement(a.Z,{id:c}):"",d)}}l.defaultProps={animation:"border",width:"50",widthUnit:"vmin",center:!0}},44615:function(e,t,n){"use strict";n.d(t,{f:function(){return r}});const r=n(67294).createContext(void 0)},16964:function(e,t,n){"use strict";n.d(t,{$A:function(){return g},$V:function(){return f},D0:function(){return c},DB:function(){return d},H5:function(){return m},JW:function(){return s},JY:function(){return p},Kp:function(){return C},LR:function(){return o},N3:function(){return u},Zg:function(){return i},ko:function(){return a},mg:function(){return h}});var r=n(51068);function o(e,t){const n=document.createElement("a");n.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(t)),n.setAttribute("download",e),n.style.display="none",document.body.appendChild(n),n.click(),document.body.removeChild(n)}function a(e,t,n,r){return e.replace(new RegExp(t.replace(/([/,!\\^${}[\]().*+?|<>\-&])/g,"\\$&"),r?"gi":"g"),n.replace(/\$/g,"$$$$"))}function s(e,t,n=!1){return"/"===e.slice(-1)&&(e=e.slice(0,-1)),"/"===t.slice(-1)&&(t=t.slice(0,-1)),(0,r.Bo)(t,void 0,{end:n}).test(e)}function i(e){return e.permissionSet??e.group?.permissionSet}function l(e,t){return!!(t&e)}function u(e,t){return l(e.administrationRights,t)}function c(e,t){return l(e.instanceManagerRights,t)}function d(e,t){return l(e.engineRights,t)}function f(e,t){return l(e.chatBotRights,t)}function h(e,t){return l(e.dreamDaemonRights,t)}function g(e,t){return l(e.dreamMakerRights,t)}function p(e,t){return l(e.instancePermissionSetRights,t)}function C(e,t){return l(e.repositoryRights,t)}function m(e,t){return l(e.configurationRights,t)}},862:function(e,t,n){var r={"./en.json":[2422,2422]};function o(e){if(!n.o(r,e))return Promise.resolve().then((function(){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}));var t=r[e],o=t[0];return n.e(t[1]).then((function(){return n.t(o,19)}))}o.keys=function(){return Object.keys(r)},o.id=862,e.exports=o}}]);
//# sourceMappingURL=9838.dadc91324f794f1f89cc.bundle.js.map
"use strict";(self.webpackChunktgstation_server_control_panel=self.webpackChunktgstation_server_control_panel||[]).push([[8153,6983],{1781:function(e,t,a){a.d(t,{d:function(){return i}});var s=a(6540),r=a(8280),n=a(5677),o=a(3399),l=a(8065);class i extends s.Component{constructor(e){super(e),this.state={animatedOpen:!1,closeTriggered:!1}}componentDidMount(){this.setState({animatedOpen:!0}),this.isCompleted()&&this.close()}componentDidUpdate(){this.isCompleted()&&this.close()}isCompleted(e){e??=this.props;return e.progress.loaded===e.progress.total||0===e.progress.total}close(){this.state.closeTriggered||(this.setState({closeTriggered:!0}),setTimeout((()=>{this.setState({animatedOpen:!1}),setTimeout(this.props.onClose,1e3)}),3e3))}render(){const e=this.props.progress.loaded===this.props.progress.total||0===this.props.progress.total;return s.createElement(r.A,{in:this.state.animatedOpen,dimension:"height"},s.createElement("div",null,s.createElement(n.A,{className:"clearfix",variant:e?"success":"primary",transition:!0},s.createElement(l.A,{id:e?"generic.downloaded":"generic.downloading",values:{file:this.props.filename}}),s.createElement("hr",null),s.createElement(o.A,{min:0,now:Math.max(1,this.props.progress.loaded),max:Math.max(1,this.props.progress.total??1),variant:e?"success":"warning",animated:!e}))))}}},6795:function(e,t,a){a.d(t,{Q:function(){return i}});var s=a(6540),r=a(8785),n=a.n(r),o=a(8437);function l(e){return s.createElement(n(),{src:e.obj,name:"JSON",theme:"tube",iconStyle:"triangle",collapsed:!0,displayDataTypes:!1})}function i(e){return o.Ay.showjson.value?s.createElement("div",{className:"text-left"},s.createElement(l,{obj:e.obj})):s.createElement(s.Fragment,null)}},5282:function(e,t,a){a.d(t,{A:function(){return p}});var s=a(6784),r=a(6540),n=a(5615),o=a(1208),l=a(5038),i=a(1069),c=a(3899),d=a(8065);function m(){return m=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var s in a)({}).hasOwnProperty.call(a,s)&&(e[s]=a[s])}return e},m.apply(null,arguments)}class p extends r.PureComponent{constructor(e){super(e),this.state={showGoto:!1,gotoValue:e.currentPage}}render(){const e=[],t=Math.max(this.props.totalPages-this.props.currentPage-1,0),a=Math.max(this.props.currentPage-2,0),p=Math.max(this.props.currentPage-Math.max(5-Number(this.props.currentPage!==this.props.totalPages)-t,2),2),h=Math.min(this.props.currentPage+Math.max(5-Number(1!==this.props.currentPage)-a,2),this.props.totalPages-1);for(let t=p;t<=h;t++)e.push(r.createElement(i.A.Item,{key:t,active:t===this.props.currentPage,onClick:()=>this.props.selectPage(t)},t));const u=this.props.totalPages>7?r.createElement(i.A.Ellipsis,{disabled:!0}):null,g=r.createElement(c.A,{id:"popover-gotopage"},r.createElement(c.A.Title,null,r.createElement(d.A,{id:"generic.goto.title"})),r.createElement(c.A.Content,null,r.createElement("form",{className:"d-flex",onSubmit:e=>{e.preventDefault(),this.props.selectPage(this.state.gotoValue),this.setState({showGoto:!1})}},r.createElement(o.A.Control,{className:"mr-2",type:"number",min:1,max:this.props.totalPages,value:this.state.gotoValue,onChange:e=>this.setState({gotoValue:parseInt(e.target.value)}),custom:!0}),r.createElement(n.A,{type:"submit"},r.createElement(d.A,{id:"generic.goto"}))))),{selectPage:E,totalPages:v,currentPage:f,...A}=this.props;return r.createElement("div",m({className:"text-center",style:{position:"sticky",bottom:"1.5em"}},A),r.createElement(i.A,{className:"justify-content-center"},r.createElement(i.A.Prev,{disabled:this.props.currentPage<=1,onClick:()=>this.props.selectPage(Math.max(this.props.currentPage-1,1))}),r.createElement(i.A.Item,{active:this.props.currentPage<=1,onClick:()=>this.props.selectPage(1)},"1"),u,e,u,this.props.totalPages>=2?r.createElement(i.A.Item,{active:this.props.currentPage>=this.props.totalPages,onClick:()=>this.props.selectPage(this.props.totalPages)},this.props.totalPages):null,this.props.totalPages>7?r.createElement(l.A,{show:this.state.showGoto,placement:"top",overlay:g},r.createElement(i.A.Item,{onClick:()=>this.setState((e=>({showGoto:!e.showGoto})))},r.createElement(s.g,{icon:"search"}))):null,r.createElement(i.A.Next,{disabled:this.props.currentPage>=this.props.totalPages,onClick:()=>this.props.selectPage(Math.min(this.props.currentPage+1,this.props.totalPages))})))}}},8153:function(e,t,a){a.r(t);var s=a(6540),r=a(5615),n=a(3048),o=a(5038),l=a(2431),i=a(3524),c=a(8065),d=a(4916),m=a(4180),p=a(4625),h=a(3490),u=a(4173),g=a(5301),E=a(4118),v=a(664),f=a(1781),A=a(7567),P=a(6795),b=a(7255),w=a(5282);function y(){return y=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var s in a)({}).hasOwnProperty.call(a,s)&&(e[s]=a[s])}return e},y.apply(null,arguments)}t.default=(0,m.y)(class extends s.Component{constructor(e){super(e),this.state={errors:[],loading:!0,logs:[],page:v.M2.loglistpage??1,downloads:[]}}componentDidUpdate(e,t){t.page!==this.state.page&&(v.M2.loglistpage=this.state.page,this.loadLogs())}componentDidMount(){(async()=>{const e=this.props.match.params.name;if(e){const t=await h.A.getLog(e,this.allocateDownload(e));switch(t.code){case g.s.OK:{const e=RegExp(/(\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}.\d{7}[-+]\d{2}:\d{2})\s+(.*?)(?=(?:\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}.\d{7}[-+]\d{2}:\d{2}|$))/,"gs");let a;const s=[];for(;null!==(a=e.exec(t.payload.content));)s.push({time:a[1],content:a[2]});this.setState({viewedLog:{logFile:t.payload,entries:s}});break}case g.s.ERROR:this.addError(t.error)}}await this.loadLogs()})()}async loadLogs(){this.setState({loading:!0});const e=await h.A.getLogs({page:this.state.page});switch(e.code){case g.s.OK:if(this.state.page>e.payload.totalPages&&0!==e.payload.totalPages)return void this.setState({page:1});this.setState({logs:e.payload.content,maxPage:e.payload.totalPages});break;case g.s.ERROR:this.addError(e.error)}this.setState({loading:!1})}addError(e){this.setState((t=>{const a=Array.from(t.errors);return a.push(e),{errors:a}}))}async downloadLog(e){const t=await h.A.getLog(e,this.allocateDownload(e));switch(t.code){case g.s.OK:(0,E.RG)(e,t.payload.content);break;case g.s.ERROR:this.addError(t.error)}}allocateDownload(e){const t=new Promise((e=>{this.setState((t=>{const a=[...t.downloads];return e(a.push(null)-1),{downloads:a}}))}));let a=0;return s=>{const r=++a;t.then((t=>{a===r&&this.setState((a=>{const r=[...a.downloads];return r[t]={filename:e,progress:s,onClose:()=>{this.setState((e=>{const a=[...e.downloads];return a[t]=null,{downloads:a}}))}},{downloads:r}}))}))}}render(){return s.createElement("div",{className:"text-center"},this.state.errors.map(((e,t)=>{if(e)return s.createElement(A.Ay,{key:t,error:e,onClose:()=>this.setState((e=>{const a=Array.from(e.errors);return a[t]=void 0,{errors:a}}))})})),this.state.downloads.map(((e,t)=>{if(e)return s.createElement(f.d,y({key:t},e))})),this.state.loading?s.createElement(b.default,{text:"loading.logs"}):this.props.match.params.name&&this.state.viewedLog?s.createElement("div",{className:"mx-5 mt-5"},s.createElement(P.Q,{obj:this.state.viewedLog}),s.createElement("h3",null,this.props.match.params.name),s.createElement(r.A,{className:"mr-1",as:p.N_,to:v.Sb.admin_logs.link??v.Sb.admin_logs.route},s.createElement(c.A,{id:"generic.goback"})),s.createElement(r.A,{onClick:()=>{(0,E.RG)(this.props.match.params.name,this.state.viewedLog.logFile.content)}},s.createElement(c.A,{id:"generic.download"})),s.createElement("hr",null),s.createElement("div",{style:{height:"60vh",display:"block"},className:"table-responsive"},s.createElement(l.A,{striped:!0,hover:!0,variant:"dark",className:"text-left"},s.createElement("thead",{className:"bg-dark",style:{position:"sticky",top:0}},s.createElement("th",null,s.createElement(c.A,{id:"generic.datetime"})),s.createElement("th",null,s.createElement(c.A,{id:"generic.entry"}))),s.createElement("tbody",null,this.state.viewedLog.entries.map((e=>s.createElement("tr",{key:e.time},s.createElement("td",{className:"py-1"},e.time),s.createElement("td",{className:"py-1"},s.createElement("pre",{className:"mb-0"},e.content))))))))):s.createElement(n.A,{className:"mt-5 mb-5"},s.createElement(P.Q,{obj:this.state.logs}),s.createElement(l.A,{striped:!0,bordered:!0,hover:!0,variant:"dark",responsive:!0},s.createElement("thead",null,s.createElement("tr",null,s.createElement("th",null,"#"),s.createElement("th",null,s.createElement(c.A,{id:"generic.name"})),s.createElement("th",null,s.createElement(c.A,{id:"generic.datetime"})),s.createElement("th",null,s.createElement(c.A,{id:"generic.action"})))),s.createElement("tbody",null,this.state.logs.map(((e,t)=>{const a=new Date(e.lastModified),n=(a.getTime()-Date.now())/1e3;return s.createElement("tr",{key:e.name},s.createElement("td",null,t),s.createElement("td",null,e.name),s.createElement(o.A,{overlay:s.createElement(i.A,{id:`${e.name}-tooltip`},a.toLocaleString())},(({ref:e,...t})=>s.createElement("td",t,s.createElement("span",{ref:e},s.createElement(d.A,{value:n,numeric:"auto",updateIntervalInSeconds:1}))))),s.createElement("td",{className:"align-middle p-0"},s.createElement(r.A,{className:"mr-1",onClick:()=>{this.props.history.push((v.Sb.admin_logs.link??v.Sb.admin_logs.route)+e.name+"/",{reload:!0})}},s.createElement(c.A,{id:"generic.view"})),s.createElement(r.A,{onClick:()=>{this.downloadLog(e.name).catch((e=>{this.addError(new u.Ay(u.O4.APP_FAIL,{jsError:e}))}))}},s.createElement(c.A,{id:"generic.download"}))))})))),s.createElement(w.A,{selectPage:e=>this.setState({page:e}),totalPages:this.state.maxPage??1,currentPage:this.state.page})))}})},1069:function(e,t,a){a.d(t,{A:function(){return w}});var s=a(8168),r=a(8587),n=a(2485),o=a.n(n),l=a(6540),i=a(6519),c=a(9703),d=["active","disabled","className","style","activeLabel","children"],m=["children"],p=l.forwardRef((function(e,t){var a=e.active,n=e.disabled,i=e.className,m=e.style,p=e.activeLabel,h=e.children,u=(0,r.A)(e,d),g=a||n?"span":c.A;return l.createElement("li",{ref:t,style:m,className:o()(i,"page-item",{active:a,disabled:n})},l.createElement(g,(0,s.A)({className:"page-link",disabled:n},u),h,a&&p&&l.createElement("span",{className:"sr-only"},p)))}));p.defaultProps={active:!1,disabled:!1,activeLabel:"(current)"},p.displayName="PageItem";var h=p;function u(e,t,a){function s(e){var s=e.children,n=(0,r.A)(e,m);return l.createElement(p,n,l.createElement("span",{"aria-hidden":"true"},s||t),l.createElement("span",{className:"sr-only"},a))}return void 0===a&&(a=e),s.displayName=e,s}var g=u("First","\xab"),E=u("Prev","\u2039","Previous"),v=u("Ellipsis","\u2026","More"),f=u("Next","\u203a"),A=u("Last","\xbb"),P=["bsPrefix","className","children","size"],b=l.forwardRef((function(e,t){var a=e.bsPrefix,n=e.className,c=e.children,d=e.size,m=(0,r.A)(e,P),p=(0,i.oU)(a,"pagination");return l.createElement("ul",(0,s.A)({ref:t},m,{className:o()(n,p,d&&p+"-"+d)}),c)}));b.First=g,b.Prev=E,b.Ellipsis=v,b.Item=h,b.Next=f,b.Last=A;var w=b},3899:function(e,t,a){a.d(t,{A:function(){return g}});var s=a(8168),r=a(8587),n=a(2485),o=a.n(n),l=a(6540),i=(a(8239),a(6519)),c=["as","bsPrefix","className","children"],d=l.forwardRef((function(e,t){var a=e.as,n=void 0===a?"div":a,d=e.bsPrefix,m=e.className,p=e.children,h=(0,r.A)(e,c);return d=(0,i.oU)(d,"popover-header"),l.createElement(n,(0,s.A)({ref:t},h,{className:o()(d,m)}),p)})),m=["as","bsPrefix","className","children"],p=l.forwardRef((function(e,t){var a=e.as,n=void 0===a?"div":a,c=e.bsPrefix,d=e.className,p=e.children,h=(0,r.A)(e,m);return c=(0,i.oU)(c,"popover-body"),l.createElement(n,(0,s.A)({ref:t},h,{className:o()(d,c)}),p)})),h=["bsPrefix","placement","className","style","children","content","arrowProps","popper","show"],u=l.forwardRef((function(e,t){var a=e.bsPrefix,n=e.placement,c=e.className,d=e.style,m=e.children,u=e.content,g=e.arrowProps,E=(e.popper,e.show,(0,r.A)(e,h)),v=(0,i.oU)(a,"popover"),f=((null==n?void 0:n.split("-"))||[])[0];return l.createElement("div",(0,s.A)({ref:t,role:"tooltip",style:d,"x-placement":f,className:o()(c,v,f&&"bs-popover-"+f)},E),l.createElement("div",(0,s.A)({className:"arrow"},g)),u?l.createElement(p,null,m):m)}));u.defaultProps={placement:"right"},u.Title=d,u.Content=p;var g=u},2431:function(e,t,a){var s=a(8168),r=a(8587),n=a(2485),o=a.n(n),l=a(6540),i=a(6519),c=["bsPrefix","className","striped","bordered","borderless","hover","size","variant","responsive"],d=l.forwardRef((function(e,t){var a=e.bsPrefix,n=e.className,d=e.striped,m=e.bordered,p=e.borderless,h=e.hover,u=e.size,g=e.variant,E=e.responsive,v=(0,r.A)(e,c),f=(0,i.oU)(a,"table"),A=o()(n,f,g&&f+"-"+g,u&&f+"-"+u,d&&f+"-striped",m&&f+"-bordered",p&&f+"-borderless",h&&f+"-hover"),P=l.createElement("table",(0,s.A)({},v,{className:A,ref:t}));if(E){var b=f+"-responsive";return"string"==typeof E&&(b=b+"-"+E),l.createElement("div",{className:b},P)}return P}));t.A=d}}]);
//# sourceMappingURL=8153.52fb57f5ed594ca1de8c.bundle.js.map
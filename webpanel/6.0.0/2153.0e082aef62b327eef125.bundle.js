"use strict";(self.webpackChunktgstation_server_control_panel=self.webpackChunktgstation_server_control_panel||[]).push([[2153,5727],{1723:function(e,t,n){n.d(t,{Ay:function(){return y},PU:function(){return f},gH:function(){return E}});var a=n(6188),r=n(6784),i=n(6540),l=n(5615),o=n(1208),s=n(5192),c=n(5038),d=n(3524),u=n(8065);function m(){return m=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)({}).hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},m.apply(null,arguments)}let f=function(e){return e.Boolean="boolean",e.Number="number",e.String="string",e.Password="password",e.Enum="enum",e}({});const p=i.forwardRef((function(e,t){return i.createElement(o.A.Control,{value:e.value,onChange:t=>e.onChange(t.target.value),disabled:e.disabled,ref:t})})),h=i.forwardRef((function(e,t){return i.createElement(o.A.Control,{value:e.value,onChange:t=>e.onChange(t.target.value),disabled:e.disabled,type:"password",ref:t})})),v=i.forwardRef((function(e,t){const n=Math.random().toString();return i.createElement("label",{htmlFor:n,className:"d-flex m-0 flex-grow-1 justify-content-center align-content-center"},i.createElement(o.A.Check,{id:n,checked:e.value,onChange:t=>e.onChange(t.target.checked),type:"switch",className:"m-auto",disabled:e.disabled,ref:t}))})),g=i.forwardRef((function(e,t){return i.createElement(o.A.Control,{value:e.value,onChange:t=>e.onChange(isNaN(t.target.valueAsNumber)?t.target.value:t.target.valueAsNumber),disabled:e.disabled,min:e.min,max:e.max,type:"number",ref:t})})),b=i.forwardRef((function(e,t){return i.createElement(o.A.Control,{value:e.value,onChange:t=>e.onChange(parseInt(t.target.value)),disabled:e.disabled,as:"select",custom:!0,ref:t},Object.entries(e.enum).filter((([e])=>isNaN(parseInt(e)))).map((([t,n])=>e.noLocalize?i.createElement("option",{key:n,value:n},t):i.createElement(u.A,{id:`${e.name}.${t}`,key:t},(e=>i.createElement("option",{key:n,value:n},e))))))})),E={[f.Enum]:0,[f.Number]:0,[f.Boolean]:!1,[f.String]:"",[f.Password]:""};function y(e){const[t,n]=(0,i.useState)(e.defaultValue??E[e.type]),o=(0,i.useRef)(null);(0,i.useEffect)((()=>{n(e.defaultValue??E[e.type])}),[e.defaultValue]),(0,i.useEffect)((()=>{switch(o.current&&(o.current.checkValidity()?o.current.classList.remove("is-invalid"):o.current.classList.add("is-invalid")),e.type){case f.Boolean:case f.Enum:case f.Number:case f.String:case f.Password:return void e.onChange(t,o.current?.checkValidity()??!0)}}),[t]);const y={string:p,password:h,boolean:v,[f.Number]:void 0,[f.Enum]:void 0},A=t!=(e.defaultValue??E[e.type]);return i.createElement(s.A,null,i.createElement(c.A,{overlay:(w=e.tooltip,w?i.createElement(d.A,{id:w},i.createElement(u.A,{id:w})):i.createElement(i.Fragment,null)),show:!!e.tooltip&&void 0},(({ref:t,...n})=>i.createElement(s.A.Prepend,{className:"w-50 w-xl-40"},i.createElement(s.A.Text,m({className:"flex-grow-1"},n),i.createElement("span",{className:A?"font-weight-bold":""},i.createElement(u.A,{id:e.name})),i.createElement("div",{className:"ml-auto"},e.disabled?i.createElement(u.A,{id:"generic.readonly"}):null,i.createElement("div",{ref:t,className:"d-inline-block ml-2",style:{visibility:e.tooltip?"unset":"hidden"}},i.createElement(r.g,{icon:a.ktq}))))))),e.type===f.Number?i.createElement(g,{value:t,onChange:e=>n(e),name:e.name,disabled:e.disabled,max:e.max,min:e.min,ref:o}):e.type===f.Enum?i.createElement(b,{value:t,onChange:e=>n(e),name:e.name,enum:e.enum,noLocalize:e.noLocalize,disabled:e.disabled}):i.createElement(y[e.type],{value:t,onChange:e=>n(e),disabled:e.disabled,name:e.type,ref:o}),i.createElement(s.A.Append,null,i.createElement(l.A,{style:{visibility:!A||e.disabled?"hidden":void 0},variant:"danger",onClick:()=>n(e.defaultValue??E[e.type])},i.createElement(r.g,{icon:"undo"}))));var w}},6113:function(e,t,n){n.d(t,{A:function(){return d}});var a=n(6540),r=n(5615),i=n(5038),l=n(3524),o=n(8065),s=n(1723);function c(){return c=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)({}).hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},c.apply(null,arguments)}function d(e){const t=new Map,n=new Map,[d,u]=(0,a.useState)({});(0,a.useEffect)((()=>{Object.keys(e.fields).forEach((e=>{u((t=>({...t,[e]:{}})))}))}),[]);for(const[r,i]of Object.entries(e.fields))n.set(r,i),t.set(i,(0,a.useState)(i.defaultValue??s.gH[i.type]));let m=!1,f=!1;for(const[e,a]of n){const[n]=t.get(a),r=d[e];if((a.defaultValue??s.gH[a.type])!=n&&(m=!0),r?.invalid&&(f=!0),m&&f)break}return e.hideDisabled&&!Object.values(e.fields).some((e=>!e.disabled))?a.createElement(a.Fragment,null):a.createElement("div",null,Object.entries(e.fields).map((([n,r])=>{const{disabled:i,...l}=r;return e.hideDisabled&&i?null:a.createElement(s.Ay,c({key:n},l,{disabled:e.readOnly||i,onChange:(e,a)=>{t.get(r)[1](e),u((e=>({...e,[n]:{...e[n],invalid:!a}})))}}))})),a.createElement("div",{className:"text-center mt-2"},a.createElement(i.A,{overlay:a.createElement(l.A,{id:"form-invalid"},a.createElement(o.A,{id:"generic.invalid_form"})),show:!!f&&void 0},a.createElement(r.A,{variant:e.readOnly||f?"danger":"success",disabled:e.readOnly||!m||f,onClick:()=>{const a={};for(const[r,i]of n){const[n]=t.get(i);(i.alwaysInclude||n!=(i.defaultValue??s.gH[i.type])||e.includeAll)&&(a[r]=n)}e.onSave(a)}},a.createElement(o.A,{id:e.saveMessageId??"generic.save"})))))}},6795:function(e,t,n){n.d(t,{Q:function(){return s}});var a=n(6540),r=n(8785),i=n.n(r),l=n(8437);function o(e){return a.createElement(i(),{src:e.obj,name:"JSON",theme:"tube",iconStyle:"triangle",collapsed:!0,displayDataTypes:!1})}function s(e){return l.Ay.showjson.value?a.createElement("div",{className:"text-left"},a.createElement(o,{obj:e.obj})):a.createElement(a.Fragment,null)}},2153:function(e,t,n){n.r(t);var a=n(6540),r=n(8065),i=n(4180),l=n(2576),o=n(1824),s=n(5301),c=n(379),d=n(7621),u=n(4118),m=n(7567),f=n(1723),p=n(6113),h=n(6795),v=n(7255);class g extends a.Component{constructor(e){super(e),this.editInstance=this.editInstance.bind(this),this.state={errors:[],moving:!1}}addError(e){this.setState((t=>{const n=Array.from(t.errors);return n.push(e),{errors:n}}))}async editInstance(e){if(e.autoUpdateCron&&e.autoUpdateInterval)return void alert("Cannot set both auto update interval and cron!");const t=this.context.instance.id;let n;e.path&&e.path!=this.context.instance.path&&(n=e.path,e.path=null,e.online=!1,this.setState({moving:!0}));const a=await o.A.editInstance({...e,id:t});if(a.code!==s.s.OK)return this.addError(a.error),void this.setState({moving:!1});if(n){const e=await o.A.editInstance({id:this.context.instance.id,path:n});if(e.code!==s.s.OK)return this.addError(e.error),this.setState({moving:!1}),void await this.context.reloadInstance();let a;do{if(await new Promise((e=>setTimeout(e,1e3))),a=await o.A.getInstance(t),a.code!==s.s.OK)return this.addError(a.error),this.setState({moving:!1}),void await this.context.reloadInstance()}while(a.payload.moveJob);const r=await o.A.editInstance({online:!0,id:t});r.code!==s.s.OK?(this.addError(r.error),this.setState({moving:!1})):c.default.registerJob(e.payload.moveJob,t)}await this.context.reloadInstance()}render(){const e=e=>(0,u.tL)((0,u.u)(this.context.user),e),t={name:{name:"fields.instance.name",type:f.PU.String,defaultValue:this.context.instance.name,disabled:!e(l.cq.Rename)},path:{name:"fields.instance.path",type:f.PU.String,defaultValue:this.context.instance.path,disabled:!e(l.cq.Relocate)},chatBotLimit:{name:"fields.instance.chatbotlimit",type:f.PU.Number,min:0,defaultValue:this.context.instance.chatBotLimit,disabled:!e(l.cq.SetChatBotLimit)},autoUpdateCron:{name:"fields.instance.cron",type:f.PU.String,defaultValue:this.context.instance.autoUpdateCron,disabled:!e(l.cq.SetAutoUpdate)},autoUpdateInterval:{name:"fields.instance.autoupdate",type:f.PU.Number,min:0,defaultValue:this.context.instance.autoUpdateInterval,disabled:!e(l.cq.SetAutoUpdate)},configurationType:{name:"fields.instance.filemode",type:f.PU.Enum,enum:l.HB,defaultValue:this.context.instance.configurationType,disabled:!e(l.cq.SetConfiguration)}};return a.createElement("div",{className:"text-center"},a.createElement("h1",null,a.createElement(r.A,{id:"view.instance.info"})),a.createElement(h.Q,{obj:this.context}),this.state.errors.map(((e,t)=>{if(e)return a.createElement(m.Ay,{key:t,error:e,onClose:()=>this.setState((e=>{const n=Array.from(e.errors);return n[t]=void 0,{errors:n}}))})})),this.state.moving?a.createElement(v.default,{text:"loading.instance.move"}):a.createElement(p.A,{fields:t,onSave:this.editInstance}))}}g.contextType=d.z,t.default=(0,i.y)(g)},7621:function(e,t,n){n.d(t,{z:function(){return a}});const a=n(6540).createContext(void 0)},5192:function(e,t,n){var a=n(8587),r=n(8168),i=n(2485),l=n.n(i),o=n(6540),s=n(6261),c=n(6519),d=["bsPrefix","size","hasValidation","className","as"],u=(0,s.A)("input-group-append"),m=(0,s.A)("input-group-prepend"),f=(0,s.A)("input-group-text",{Component:"span"}),p=o.forwardRef((function(e,t){var n=e.bsPrefix,i=e.size,s=e.hasValidation,u=e.className,m=e.as,f=void 0===m?"div":m,p=(0,a.A)(e,d);return n=(0,c.oU)(n,"input-group"),o.createElement(f,(0,r.A)({ref:t},p,{className:l()(u,n,i&&n+"-"+i,s&&"has-validation")}))}));p.displayName="InputGroup",p.Text=f,p.Radio=function(e){return o.createElement(f,null,o.createElement("input",(0,r.A)({type:"radio"},e)))},p.Checkbox=function(e){return o.createElement(f,null,o.createElement("input",(0,r.A)({type:"checkbox"},e)))},p.Append=u,p.Prepend=m,t.A=p}}]);
//# sourceMappingURL=2153.0e082aef62b327eef125.bundle.js.map
(self.webpackChunktgstation_server_control_panel=self.webpackChunktgstation_server_control_panel||[]).push([[9558,7255],{8801:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return S}});var r=n(6540),o=n(445),s=n(4173),a=n(5301),i=n(3728),l=n(1552),u=n(536),c=n(7255),d=n(7864),f=n(5760);class h{constructor(e,t){this.locale=e,this.messages=t}}class g{static getShortHandedLocale(e){return e.split("-")[0]}async loadTranslation(e){const t=await n(1931)(`./${e}.json`);if(!t){let t=g.getShortHandedLocale(e);if(t===e){if(t===g.fallbackLocale)throw new Error("Invalid locale: "+e);t=g.fallbackLocale}return await this.loadTranslation(t)}let r=null;try{r=new h(e,t)}catch(t){throw Error(`Error loading localization for locale '${e}': ${JSON.stringify(t)}`)}return r}}g.fallbackLocale=f.A.en;var p=g;const C=Promise.all([n.e(5393),n.e(7142)]).then(n.bind(n,7142)),x=Promise.all([n.e(8364),n.e(5330)]).then(n.bind(n,5330)),m=n.e(8325).then(n.bind(n,8325)),v=Promise.all([n.e(379),n.e(4945)]).then(n.bind(n,379)),I=r.lazy((()=>Promise.all([n.e(379),n.e(3490),n.e(8364),n.e(4945),n.e(6959),n.e(7194)]).then(n.bind(n,572))));class E extends r.Component{constructor(e){super(e),this.translationFactory=void 0,this.finishLogin=this.finishLogin.bind(this),this.finishLogout=this.finishLogout.bind(this),this.updateContextUser=this.updateContextUser.bind(this),this.updateContextServer=this.updateContextServer.bind(this),this.deleteGeneralContextError=this.deleteGeneralContextError.bind(this),this.translationFactory=this.props.translationFactory??new p,this.state={loggedIn:!1,loggedOut:!1,loading:!0,polyfills:!1,GeneralContextInfo:{errors:new Set,user:null,serverInfo:null,deleteError:this.deleteGeneralContextError}}}async updateContextUser(){const e=await l.A.getCurrentUser();e.code===a.s.OK?this.setState((t=>({GeneralContextInfo:{errors:t.GeneralContextInfo.errors,user:e.payload,serverInfo:t.GeneralContextInfo.serverInfo,deleteError:t.GeneralContextInfo.deleteError}}))):e.error.code===s.O4.HTTP_ACCESS_DENIED?this.setState((e=>({GeneralContextInfo:{user:null,serverInfo:e.GeneralContextInfo.serverInfo,deleteError:e.GeneralContextInfo.deleteError,errors:e.GeneralContextInfo.errors}}))):(setTimeout((()=>{this.updateContextUser()}),5e3),this.setState((t=>{const n=new Set(t.GeneralContextInfo.errors);return n.add(e.error),{GeneralContextInfo:{errors:n,deleteError:t.GeneralContextInfo.deleteError,user:null,serverInfo:t.GeneralContextInfo.serverInfo}}})))}async updateContextServer(e){const t=await i.A.getServerInfo();t.code===a.s.OK?this.setState((n=>{const r=new Set(n.GeneralContextInfo.errors);return e&&r.delete(e),{GeneralContextInfo:{errors:r,user:n.GeneralContextInfo.user,serverInfo:t.payload,deleteError:n.GeneralContextInfo.deleteError}}})):(setTimeout((()=>{this.updateContextServer(t.error)}),5e3),this.setState((n=>{const r=new Set(n.GeneralContextInfo.errors);return r.add(t.error),e&&r.delete(e),{GeneralContextInfo:{errors:r,deleteError:n.GeneralContextInfo.deleteError,user:n.GeneralContextInfo.user,serverInfo:null}}})))}deleteGeneralContextError(e){this.setState((t=>{const n=new Set(t.GeneralContextInfo.errors);return n.delete(e),{GeneralContextInfo:{deleteError:t.GeneralContextInfo.deleteError,user:t.GeneralContextInfo.user,serverInfo:t.GeneralContextInfo.serverInfo,errors:n}}}))}finishLogin(){console.log("Logging in"),this.updateContextUser().then((()=>this.setState({loggedIn:!0,loading:!1})))}finishLogout(){this.setState({loggedIn:!1,loggedOut:!0}),this.updateContextUser()}componentDidMount(){(async()=>{(await x).default(),(await m).default.loadconfig(),(await v).default.init(),u.A.on("loginSuccess",this.finishLogin),i.A.on("logout",this.finishLogout),i.A.on("purgeCache",this.updateContextServer),i.A.on("purgeCache",this.updateContextUser),await C,this.setState({polyfills:!0}),await this.loadTranslation();const e=await i.A.initApi();await this.updateContextServer(),e&&await this.updateContextUser(),this.setState({loading:!1,loggedIn:e})})()}componentWillUnmount(){u.A.removeListener("loginSuccess",this.finishLogin),i.A.removeListener("logout",this.finishLogout),i.A.removeListener("purgeCache",this.updateContextServer),i.A.removeListener("purgeCache",this.updateContextUser)}render(){return this.state.polyfills?this.state.translationError?r.createElement("p",{className:"App-error"},this.state.translationError):this.state.translation?r.createElement(o.A,{locale:this.state.translation.locale,messages:this.state.translation.messages,defaultLocale:"en"},r.createElement(r.Suspense,{fallback:r.createElement(c.default,{text:"loading.app"})},r.createElement(d.U.Provider,{value:this.state.GeneralContextInfo},r.createElement(I,{loading:this.state.loading,loggedIn:this.state.loggedIn,loggedOut:this.state.loggedOut})))):r.createElement(c.default,null,"Loading translations..."):r.createElement(c.default,null,"Loading polyfills...")}async loadTranslation(){console.time("LoadTranslations");try{const e=await this.translationFactory.loadTranslation(this.props.locale);this.setState({translation:e})}catch(e){return void this.setState({translationError:JSON.stringify(e)??"An unknown error occurred"})}console.timeEnd("LoadTranslations")}}var S=E},7255:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return l}});var r=n(6540),o=n(778),s=n(8065);function a(){return a=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},a.apply(null,arguments)}const i=r.lazy((()=>n.e(3318).then(n.bind(n,3318))));class l extends r.Component{render(){return r.createElement(r.Suspense,{fallback:this.renderSpinner()},r.createElement(i,null,this.renderSpinner()))}renderSpinner(){const{variant:e,animation:t,center:n,className:i,width:l,widthUnit:u,text:c,children:d,...f}=this.props,h={width:`${l}${u}`,height:`${l}${u}`};return r.createElement("div",{className:n?"text-center":""},r.createElement(o.A,a({variant:e||"secondary",className:n?`d-block mx-auto ${i??""}`:i,style:h,animation:t||"border"},f)),c?this.props.noIntl?c:r.createElement(s.A,{id:c}):"",d)}}l.defaultProps={animation:"border",width:"50",widthUnit:"vmin",center:!0}},7864:function(e,t,n){"use strict";n.d(t,{U:function(){return r}});const r=n(6540).createContext(void 0)},4118:function(e,t,n){"use strict";n.d(t,{$h:function(){return a},CM:function(){return u},Dp:function(){return d},Ex:function(){return x},GY:function(){return h},O2:function(){return p},OQ:function(){return f},RG:function(){return o},bQ:function(){return C},eG:function(){return g},tL:function(){return c},u:function(){return i},yh:function(){return s}});var r=n(5867);function o(e,t){const n=document.createElement("a");n.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(t)),n.setAttribute("download",e),n.style.display="none",document.body.appendChild(n),n.click(),document.body.removeChild(n)}function s(e,t,n,r){return e.replace(new RegExp(t.replace(/([/,!\\^${}[\]().*+?|<>\-&])/g,"\\$&"),r?"gi":"g"),n.replace(/\$/g,"$$$$"))}function a(e,t,n=!1){return"/"===e.slice(-1)&&(e=e.slice(0,-1)),"/"===t.slice(-1)&&(t=t.slice(0,-1)),(0,r.MM)(t,void 0,{end:n}).test(e)}function i(e){return e.permissionSet??e.group?.permissionSet}function l(e,t){return!!(t&e)}function u(e,t){return l(e.administrationRights,t)}function c(e,t){return l(e.instanceManagerRights,t)}function d(e,t){return l(e.engineRights,t)}function f(e,t){return l(e.chatBotRights,t)}function h(e,t){return l(e.dreamDaemonRights,t)}function g(e,t){return l(e.dreamMakerRights,t)}function p(e,t){return l(e.instancePermissionSetRights,t)}function C(e,t){return l(e.repositoryRights,t)}function x(e,t){return l(e.configurationRights,t)}},1931:function(e,t,n){var r={"./en.json":[2161,2161]};function o(e){if(!n.o(r,e))return Promise.resolve().then((function(){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}));var t=r[e],o=t[0];return n.e(t[1]).then((function(){return n.t(o,19)}))}o.keys=function(){return Object.keys(r)},o.id=1931,e.exports=o}}]);
//# sourceMappingURL=9558.f9f49501456653dad01f.bundle.js.map
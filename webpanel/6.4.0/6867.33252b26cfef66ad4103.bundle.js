"use strict";(self.webpackChunktgstation_server_control_panel=self.webpackChunktgstation_server_control_panel||[]).push([[6867],{2153:function(e,t,a){a.r(t);var n=a(6540),i=a(8065),s=a(4180),r=a(2576),o=a(1824),l=a(5301),c=a(379),d=a(7621),m=a(4118),u=a(7567),p=a(1723),h=a(6113),f=a(6795),S=a(7255);class y extends n.Component{constructor(e){super(e),this.editInstance=this.editInstance.bind(this),this.state={errors:[],moving:!1}}addError(e){this.setState((t=>{const a=Array.from(t.errors);return a.push(e),{errors:a}}))}async editInstance(e){if(e.autoUpdateCron&&e.autoUpdateInterval)return void alert("Cannot set both auto update interval and cron!");const t=this.context.instance.id;let a;e.path&&e.path!=this.context.instance.path&&(a=e.path,e.path=null,e.online=!1,this.setState({moving:!0}));const n=await o.A.editInstance({...e,id:t});if(n.code!==l.s.OK)return this.addError(n.error),void this.setState({moving:!1});if(a){const e=await o.A.editInstance({id:this.context.instance.id,path:a});if(e.code!==l.s.OK)return this.addError(e.error),this.setState({moving:!1}),void await this.context.reloadInstance();let n;do{if(await new Promise((e=>setTimeout(e,1e3))),n=await o.A.getInstance(t),n.code!==l.s.OK)return this.addError(n.error),this.setState({moving:!1}),void await this.context.reloadInstance()}while(n.payload.moveJob);const i=await o.A.editInstance({online:!0,id:t});i.code!==l.s.OK?(this.addError(i.error),this.setState({moving:!1})):c.default.registerJob(e.payload.moveJob,t)}await this.context.reloadInstance()}render(){const e=e=>(0,m.tL)((0,m.u)(this.context.user),e),t={name:{name:"fields.instance.name",type:p.PU.String,defaultValue:this.context.instance.name,disabled:!e(r.cq.Rename)},path:{name:"fields.instance.path",type:p.PU.String,defaultValue:this.context.instance.path,disabled:!e(r.cq.Relocate)},chatBotLimit:{name:"fields.instance.chatbotlimit",type:p.PU.Number,min:0,defaultValue:this.context.instance.chatBotLimit,disabled:!e(r.cq.SetChatBotLimit)},autoUpdateCron:{name:"fields.instance.cron",type:p.PU.String,defaultValue:this.context.instance.autoUpdateCron,disabled:!e(r.cq.SetAutoUpdate)},autoUpdateInterval:{name:"fields.instance.autoupdate",type:p.PU.Number,min:0,defaultValue:this.context.instance.autoUpdateInterval,disabled:!e(r.cq.SetAutoUpdate)},configurationType:{name:"fields.instance.filemode",type:p.PU.Enum,enum:r.HB,defaultValue:this.context.instance.configurationType,disabled:!e(r.cq.SetConfiguration)}};return n.createElement("div",{className:"text-center"},n.createElement("h1",null,n.createElement(i.A,{id:"view.instance.info"})),n.createElement(f.Q,{obj:this.context}),this.state.errors.map(((e,t)=>{if(e)return n.createElement(u.Ay,{key:t,error:e,onClose:()=>this.setState((e=>{const a=Array.from(e.errors);return a[t]=void 0,{errors:a}}))})})),this.state.moving?n.createElement(S.default,{text:"loading.instance.move"}):n.createElement(h.A,{fields:t,onSave:this.editInstance}))}}y.contextType=d.z,t.default=(0,s.y)(y)},5998:function(e,t,a){a.r(t),a.d(t,{Deployment:function(){return E}});var n=a(6540),i=a(5615),s=a(8065),r=a(1930),o=a(2576),l=a(5301),c=a(379),d=a(7621),m=a(4118),u=a(9956),p=a(7567),h=a(5659),f=a(1723),S=a(6113),y=a(6795),b=a(7255),g=a(1512);function E(){const e=(0,n.useContext)(d.z),t=(0,n.useState)([]),[a,E]=(0,n.useState)(!0),[v,A]=(0,n.useState)(null),[P,C]=(0,n.useState)(null),[x,w]=(0,n.useState)(1),[I,N]=(0,n.useState)(0),[B,R]=(0,n.useState)(5),V=(0,m.eG)(e.instancePermissionSet,o.rY.Read),U=(0,m.eG)(e.instancePermissionSet,o.rY.Compile),O=(0,m.eG)(e.instancePermissionSet,o.rY.CompileJobs);async function k(){if(!V)return E(!1);E(!0);const a=await r.A.getDeployInfo(e.instance.id);E(!1),a.code===l.s.OK?A(a.payload):(0,p.CN)(t,a.error)}async function D(a){if(!O)return;C(null);const n=await r.A.listCompileJobs(e.instance.id,{page:a,pageSize:B});n.code===l.s.OK?(B||R(n.payload.pageSize),N(n.payload.totalPages),w(a),C(n.payload.content)):(0,p.CN)(t,n.error)}let Y;(0,n.useEffect)((()=>{k(),D(1)}),[e.instance.id]);const K=/(?:(?<days>\d+)\.)?(?<hours>\d+):(?<minutes>\d+):(?<seconds>\d+)/.exec(v?.timeout??"");if(K){const e=K.groups;Y=60*(24*parseInt(e.days??0)+parseInt(e.hours))+parseInt(e.minutes)+parseInt(e.seconds)/60}const M={projectName:{type:f.PU.String,name:"fields.instance.deploy.projectname",tooltip:"fields.instance.deploy.projectname.desc",defaultValue:v?.projectName,disabled:!(0,m.eG)(e.instancePermissionSet,o.rY.SetDme)},compilerAdditionalArguments:{type:f.PU.String,name:"fields.instance.deploy.compilerargs",tooltip:"fields.instance.deploy.compilerargs.desc",defaultValue:v?.compilerAdditionalArguments,disabled:!(0,m.eG)(e.instancePermissionSet,o.rY.SetCompilerArguments)},timeout:{type:f.PU.Number,name:"fields.instance.deploy.timeout",tooltip:"fields.instance.deploy.timeout.desc",defaultValue:Y,disabled:!(0,m.eG)(e.instancePermissionSet,o.rY.SetTimeout)},apiValidationPort:{type:f.PU.Number,min:0,max:65535,name:"fields.instance.deploy.apiport",tooltip:"fields.instance.deploy.apiport.desc",defaultValue:v?.apiValidationPort,disabled:!(0,m.eG)(e.instancePermissionSet,o.rY.SetApiValidationPort)},apiValidationSecurityLevel:{type:f.PU.Enum,enum:o.GZ,name:"fields.instance.deploy.seclevel",tooltip:"fields.instance.deploy.seclevel.desc",defaultValue:v?.apiValidationSecurityLevel,disabled:!(0,m.eG)(e.instancePermissionSet,o.rY.SetSecurityLevel)},dmApiValidationMode:{type:f.PU.Enum,enum:o.u3,name:"fields.instance.deploy.validateapi",tooltip:"fields.instance.deploy.validateapi.desc",defaultValue:v?.dmApiValidationMode,disabled:!(0,m.eG)(e.instancePermissionSet,o.rY.SetApiValidationRequirement)}};let W=null;const j={currentPage:x,totalPages:I,loadPage:D,pageSize:B??0};return O?P&&(W={viewDataType:u.G.CompileJobs,compileJobs:P,paging:j}):W={viewDataType:u.G.CompileJobs,paging:j},n.createElement("div",{className:"text-center"},n.createElement(y.Q,{obj:{deployInfo:v}}),(0,p.u9)(t),O?n.createElement(u.A,{viewData:W}):n.createElement(h.A,{title:"view.instance.no_compile_jobs"}),n.createElement("hr",null),n.createElement("h3",null,n.createElement(s.A,{id:"view.instance.deploy.title"})),V?null:n.createElement(h.A,{title:"view.instance.no_metadata"}),a?n.createElement(b.default,{text:"loading.deployments"}):n.createElement(n.Fragment,null,n.createElement(S.A,{hideDisabled:!V,fields:M,onSave:async a=>{let n;if(a.timeout){const e=Math.floor(a.timeout/1440);a.timeout-=1440*e;const t=Math.floor(a.timeout/60);a.timeout-=60*t;const i=Math.floor(a.timeout);a.timeout-=i;const s=Math.floor(60*a.timeout);n=e?`${e}.${t}:${i}:${s}`:`${t}:${i}:${s}`}const i={...a,timeout:n};E(!0);const s=await r.A.updateDeployInfo(e.instance.id,i);s.code===l.s.ERROR?(0,p.CN)(t,s.error):await k(),E(!1)}}),n.createElement("hr",null),n.createElement(g.A,{tooltipid:"generic.no_perm",show:!U&&void 0},n.createElement(i.A,{disabled:!U,onClick:()=>{(async()=>{const a=await r.A.startCompile(e.instance.id);a.code===l.s.ERROR?(0,p.CN)(t,a.error):(c.default.registerJob(a.payload,e.instance.id),c.default.fastmode=5)})()}},n.createElement(s.A,{id:"view.instance.deploy.deploy"})))))}},9272:function(e,t,a){a.r(t),a.d(t,{default:function(){return h}});var n=a(6540),i=a(4295),s=a(5301),r=a(379),o=a(7621),l=a(664),c=a(7567),d=a(2306),m=a(6795),u=a(7255),p=a(5282);function h(){const e=n.useContext(o.z),[t,a]=(0,n.useState)([]),[h,f]=(0,n.useState)([]),[S,y]=(0,n.useState)(!0),[b,g]=(0,n.useState)(l.M2.jobhistorypage.get(e.instance.id)??1),[E,v]=(0,n.useState)(void 0);function A(e){f((t=>{const a=Array.from(t);return a.push(e),a}))}return(0,n.useEffect)((()=>{l.M2.jobhistorypage.set(e.instance.id,b),y(!0),async function(){const t=await i.A.listJobs(e.instance.id,{page:b});t.code===s.s.OK?(b>t.payload.totalPages&&0!==t.payload.totalPages&&g(1),a(t.payload.content),v(t.payload.totalPages)):A(t.error),y(!1)}()}),[b,e.instance.id]),(0,n.useEffect)((()=>{}),[h]),S?n.createElement(u.default,{text:"loading.instance.jobs.list"}):n.createElement("div",null,n.createElement(m.Q,{obj:t}),h.map(((e,t)=>{if(e)return n.createElement(c.Ay,{key:t,error:e,onClose:()=>f((e=>{const a=Array.from(e);return a[t]=void 0,a}))})})),t.sort(((e,t)=>t.id-e.id)).filter((e=>!!e.stoppedAt)).map((e=>n.createElement(d.A,{job:e,key:e.id,onCancel:e=>{!async function(e){const t=await i.A.deleteJob(e.instanceId,e.id);t.code===s.s.OK?r.default.fastmode=5:A(t.error)}(e)}}))),n.createElement(p.A,{selectPage:e=>g(e),totalPages:E??1,currentPage:b}))}},9248:function(e,t,a){a.r(t);var n=a(6188),i=a(6784),s=a(6540),r=a(472),o=a(6867),l=a(1008),c=a(8065),d=a(4180),m=a(2576),u=a(1824),p=a(2589),h=a(5301),f=a(8437),S=a(7864),y=a(7621),b=a(664),g=a(992),E=a(7255),v=a(5755),A=a(3763),P=a(2153),C=a(5998),x=a(4717),w=a(1606),I=a(9496),N=a(9272),B=a(3649),R=a(8018);const V=m.em.ReadActive|m.em.ListInstalled|m.em.InstallOfficialOrChangeActiveByondVersion|m.em.InstallCustomByondVersion|m.em.InstallOfficialOrChangeActiveOpenDreamVersion|m.em.InstallCustomOpenDreamVersion,U=m.NB.SetPort|m.NB.SetAutoStart|m.NB.SetSecurity|m.NB.ReadMetadata|m.NB.SetWebClient|m.NB.SoftRestart|m.NB.SoftShutdown|m.NB.Restart|m.NB.Shutdown|m.NB.Start|m.NB.SetStartupTimeout|m.NB.SetHealthCheckInterval|m.NB.CreateDump|m.NB.SetTopicTimeout|m.NB.SetAdditionalParameters|m.NB.SetVisibility,O=m.WX.SetOrigin|m.WX.SetSha|m.WX.MergePullRequest|m.WX.UpdateBranch|m.WX.ChangeCommitter|m.WX.ChangeTestMergeCommits|m.WX.ChangeCredentials|m.WX.SetReference|m.WX.Read|m.WX.ChangeAutoUpdateSettings|m.WX.Delete|m.WX.ChangeSubmoduleUpdate,k=m.rY.Read|m.rY.Compile|m.rY.SetApiValidationPort|m.rY.SetDme|m.rY.SetApiValidationRequirement|m.rY.SetTimeout|m.rY.SetSecurityLevel,D=m.B5.Read|m.B5.Create,Y=m.qd.Read|m.qd.List|m.qd.Write;class K extends s.Component{constructor(e){super(e),this.reloadInstance=this.reloadInstance.bind(this),this.deleteContextError=this.deleteContextError.bind(this),b.M2.selectedinstanceid=parseInt(this.props.match.params.id),this.state={tab:e.match.params.tab??K.tabs[0][0],errors:new Set,instance:null,instancePermissionSet:null,reloadInstance:this.reloadInstance,deleteError:this.deleteContextError,instanceid:parseInt(this.props.match.params.id)}}deleteContextError(e){this.setState((t=>{const a=new Set(t.errors);return a.delete(e),{errors:a}}))}componentDidMount(){this.reloadInstance()}componentDidUpdate(e){this.props.match.params.tab&&e.match.params.tab!=this.props.match.params.tab&&this.setState({tab:this.props.match.params.tab})}async reloadInstance(){this.setState({instance:null,instancePermissionSet:null});const e=await u.A.getInstance(this.state.instanceid);if(e.code===h.s.OK){this.setState({instance:e.payload});const t=await p.A.getCurrentInstancePermissionSet(this.state.instanceid,!0);t.code===h.s.OK?this.setState({instancePermissionSet:t.payload}):this.setState((e=>{const a=new Set(e.errors);return a.add(t.error),{instancePermissionSet:null,errors:a}}))}else this.setState((t=>{const a=new Set(t.errors);return a.add(e.error),{instance:null,errors:a}}))}render(){if(!this.state.instance||!this.state.instancePermissionSet)return s.createElement(E.default,{text:"loading.instance"});return s.createElement(y.z.Provider,{value:Object.assign({user:this.context.user,serverInfo:this.context.serverInfo},this.state)},s.createElement(r.A,{className:"behind-nav"},s.createElement(r.A.Header,{className:"text-center mb-2 sticky-top"},s.createElement("h3",null,s.createElement(c.A,{id:"view.instanceedit.title",values:{instanceid:this.props.match.params.id,instancename:this.state.instance.name}})),s.createElement("h5",{className:"text-white-50"},s.createElement(c.A,{id:`view.instanceedit.tabs.${this.state.tab}`}))),s.createElement(l.A.Container,{mountOnEnter:!0,unmountOnExit:!0,id:"instanceedit",activeKey:this.state.tab},s.createElement("div",{className:"d-flex flex-row z-front"},s.createElement(r.A.Body,{className:"flex-grow-0"},(()=>s.createElement(o.A,{defaultActiveKey:this.state.tab,onSelect:e=>{e=e??K.tabs[0][0],b.M2.selectedinstanceedittab=e,this.props.history.push(b.Sb.instanceedit.link??b.Sb.instanceedit.route),this.setState({tab:e??K.tabs[0][0]})},fill:!0,variant:"pills",activeKey:this.state.tab,className:"flex-nowrap text-nowrap flex-column hover-bar sticky-top "+(f.Ay.instanceeditsidebar.value===f.iD.COLLAPSE?"pin-close":f.Ay.instanceeditsidebar.value===f.iD.EXPAND?"pin-open":""),style:{top:"8em"}},K.tabs.map((([e,t,a,n])=>{if(!this.state.instancePermissionSet)throw Error("this.state.instancePermissionSet is null in instanceedit nav map");const r=!n,l=!a(this.state.instancePermissionSet,this.context);return s.createElement(o.A.Item,{key:e},s.createElement(o.A.Link,{eventKey:e,bsPrefix:"nav-link instanceedittab",className:(r?"no-access text-white":"")+(l?"no-access text-white font-italic":"")+" text-left"},s.createElement(s.Fragment,null,s.createElement(i.g,{icon:l?"lock":t,fixedWidth:!0}),s.createElement("div",{className:"tab-text d-inline-block "+(l?"font-weight-lighter":"")},s.createElement("span",{className:"pl-1"},s.createElement(c.A,{id:`view.instanceedit.tabs.${e}`}))))))}))))()),s.createElement(r.A.Body,{className:"bg-body"},s.createElement(l.A.Content,null,K.tabs.map((([e,,t,a])=>{if(!this.state.instancePermissionSet)throw Error("this.state.instancePermissionSet is null in render card map");return s.createElement(l.A.Pane,{eventKey:e,key:e},a?t(this.state.instancePermissionSet,this.context)?s.createElement(a,null):s.createElement(g.A,null):s.createElement(v.A,null))}))))))))}}K.tabs=[["info","info",()=>!0,P.default],["repository","code-branch",e=>!!(e.repositoryRights&O),B.default],["engine",n.Rbk,e=>!!(e.engineRights&V),x.default],["deployment","hammer",e=>!!(e.dreamMakerRights&k),C.Deployment],["dreamdaemon","server",e=>!!(e.dreamDaemonRights&U),R.default],["chatbots","comments",e=>!!(e.chatBotRights&D),A.default],["files","folder-open",e=>!!(e.configurationRights&Y),w.default],["users","users",()=>!0,I.default],["jobs","stream",()=>!0,N.default]],K.contextType=S.U,t.default=(0,d.y)(K)}}]);
//# sourceMappingURL=6867.33252b26cfef66ad4103.bundle.js.map
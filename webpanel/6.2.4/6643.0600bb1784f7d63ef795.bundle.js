"use strict";(self.webpackChunktgstation_server_control_panel=self.webpackChunktgstation_server_control_panel||[]).push([[6643],{6643:function(t,e,s){s.r(e);var r=s(6540),a=s(5615),o=s(1105),n=s(1208),i=s(8065),l=s(4180),d=s(6382),h=s(4173),c=s(5301),u=s(3728),m=s(1552),p=s(7864),E=s(7567),w=s(7255);class g extends r.Component{constructor(t,e){if(super(t),!e?.user)throw Error("ChangePassword: this.context?.user is null!");let s;s=t.match.params.id?parseInt(t.match.params.id):e.user.id,this.state={errors:[],password1:"",password2:"",userId:s,currentUser:e.user.id===s,loading:!0},this.submit=this.submit.bind(this)}async componentDidMount(){const t=await m.A.getUser(this.state.userId);t.code==c.s.OK?this.setState({user:t.payload}):this.addError(t.error),this.setState({loading:!1})}addError(t){this.setState((e=>{const s=Array.from(e.errors);return s.push(t),{errors:s}}))}async submit(t){if(!this.state.user)return void this.addError(new h.Ay(h.O4.APP_FAIL,{jsError:Error("changepassword submit: this.user is falsy")}));t.preventDefault();let e=!1;if(this.state.password1.length<this.context.serverInfo.minimumPasswordLength?(e=!0,this.setState({lengthError:!0})):this.setState({lengthError:!1}),this.state.password2!==this.state.password1?(e=!0,this.setState({matchError:!0})):this.setState({matchError:!1}),e)return;this.setState({pwdload:!0});const s=await m.A.editUser({password:this.state.password1,id:this.state.user.id});switch(s.code){case c.s.OK:this.state.currentUser&&u.A.login({type:d.$.Password,userName:this.state.user.name,password:this.state.password1}),this.props.history.goBack();break;case c.s.ERROR:this.addError(s.error),this.setState({pwdload:!1})}}render(){if(this.state.loading)return r.createElement(w.default,{text:"loading.info"});if(this.state.pwdload)return r.createElement(w.default,{text:"loading.passwd"});return r.createElement(n.A,{onSubmit:t=>{this.submit(t)}},r.createElement(o.A,{className:"mx-auto",lg:5,md:8},this.state.errors.map(((t,e)=>{if(t)return r.createElement(E.Ay,{key:e,error:t,onClose:()=>this.setState((t=>{const s=Array.from(t.errors);return s[e]=void 0,{errors:s}}))})})),this.state.user?r.createElement(r.Fragment,null,r.createElement("h3",null,r.createElement(i.A,{id:"view.user.passwd.title"}),this.state.user.name,"(",this.state.user.id,")"),r.createElement("hr",null),r.createElement(n.A.Group,{controlId:"password1"},r.createElement(n.A.Label,null,r.createElement(i.A,{id:"login.password"})),r.createElement(n.A.Control,{type:"password",onChange:t=>this.setState({password1:t.target.value}),value:this.state.password1,isInvalid:this.state.matchError||this.state.lengthError}),r.createElement(n.A.Control.Feedback,{type:"invalid"},this.state.lengthError?r.createElement(r.Fragment,null,r.createElement(i.A,{id:"login.password.repeat.short"}),this.context.serverInfo.minimumPasswordLength):"")),r.createElement(n.A.Group,{controlId:"password2"},r.createElement(n.A.Label,null,r.createElement(i.A,{id:"login.password.repeat"})),r.createElement(n.A.Control,{type:"password",onChange:t=>this.setState({password2:t.target.value}),value:this.state.password2,isInvalid:this.state.matchError||this.state.lengthError}),r.createElement(n.A.Control.Feedback,{type:"invalid"},this.state.matchError?r.createElement(i.A,{id:"login.password.repeat.match"}):"")),r.createElement(a.A,{type:"submit"},r.createElement(i.A,{id:"routes.passwd"}))):""))}}g.contextType=p.U,e.default=(0,l.y)(g)}}]);
//# sourceMappingURL=6643.0600bb1784f7d63ef795.bundle.js.map
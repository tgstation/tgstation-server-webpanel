# Versioning schemes

## Webpanel version
This version loosely follows semver. Major version bumps are done when the build process changes in a non backwards compatible way. Minor version bumps are done when new features are added and patch version bumps are done basically never.
In general, a new release is only done once in a while to allow the next TGS version to take advantage of the new features added since. Only the latest webpanel version receives updates, new features and bug fixes. Older versions are NOT supported. Ideally, compatibility shims for unsupported API versions (and by extension TGS versions) should be removed after any version bump.

## TGS API
Version of the TGS HTTP API version, each webpanel version supports a range of TGS API versions. Hence, care should be taken to ensure that new webpanel features are a minimum compatible with older APIs that don't include the corresponding feature (minimum here being defined as not crash and burn or break existing functionality, its OK if the feature doesn't work, no need to shim everything). In the event that backwards compatibility CANNOT be maintained for whatever reason, the feature should go in a new webpanel version at which point, the old version becomes deprecated and unsupported. The webpanel should, as much as possible, be agnostic to the version of TGS the host is running. However, bug exists and its possible that the TGS version is used to enable workarounds.

# Technical details

## Bootstraping process
The webpanel has the ability to self update even after it has been bundled into TGS by pulling code directly from github instead of using the (fallback) webpanel bundled with the TGS binary. It does so by using github pages, the contents of which can be seen inside the `live` branch. TGS's config contains a Webpanel/Channel field which is by default set to pull from `https://tgstation.github.io/tgstation-server-webpanel/api/${apiversion}`. Folders inside the `api` folder are symlinked to a folder inside the `webpanel` folder who's name corresponds to the webpanel version in the `package.json`. The webpanel bootstrapper will attempt to read a `webpanelmanifest.json` file inside the Webpanel/Channel URL. The `webpanelmanifest.json` contains a list of entrypoints that should be executed on the page to load the webpanel.

## Automated deployment process
On commit to the `next` branch, if CI passes, the contents are built and copied to the `webpanel/${webpanelversion}` within the `live` branch to be deployed to github pages. The `webpanelmanifest.json` file is automatically generated by webpack via the use of a custom plugin.

## Changing the apiVersion -> webpanelVersion bindings

#### Continuous Deployment *should* do this for you if you version correctly

In the `live` branch, change the target of the symlink inside the `api` folder who's name corresponds to the version of the API.
To create a new API -> Webpanel binding, create a symlink inside the `api` folder pointing to the correct `webpanel/${webpanelVersion}` folder. For example, to bind api version 9.6.2 to webpanel version 3.0.1, run the following commands (on linux):
```bash
git checkout live
cd api
ln -s ../webpanel/3.0.1 9.6.1
```
***IMPORTANT***: On windows, you need to either run these commands as admin or enable developper mode(and possibly a setting of dev mode) on windows 10+. You may also have to change your git config to allow symlinks. This is because, by default, only admins can create symlinks on windows.

## Releasing a new webpanel version
Shrimply use the `npm version` command to create the tag, commit and change the version inside the package*.json files. Then, follow the commands above to change the API bindings
